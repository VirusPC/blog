---
title: '模块化'
categories: ['前端']
tags: ['前端', '模块化', 'module', 'javascript', 'CommonJS', 'AMD', 'CMD', 'ES6']
resource_path: /blog/assets/2020/
---


# CommonJS, AMD, CMD, ES6

## 目录

* [CommonJS](#commonjs)
* [AMD](#amd)
* [CMD](#cmd)
* [ES6](#es6)

---

## CommonJS

### 说明

* http://wiki.commonjs.org/wiki/Modules

* 每个文件都可以当作一个模块

* 在服务器端: 模块的加载时运行时同步加载的.  
  在浏览器端: 模块需要提前编译打包处理.

### 基本语法

* 暴露模块  
    * ``` module.exports = value ```
    * ``` module.exports.xxx = value ```  
    *  ``` exports.xxx = value ``` (上一条的简写)
    * 问: 暴露的模块到底是什么?  
      答: 暴露的是```exports```这个对象.

* 引入模块  
    * ```let module2 = require(xxx)```
    * 第三方模块: ```xxx```为模块名
    * 自定义模块: ```xxx```为模块文件路径

* html页面加载模块
    ```html
    <script src="module.js"></script>
    ```

* 使用模块
    * 引入的```module2```, 相当于模块文件里的```module.exports```对象

* 例子
    1. 暴露一个对象  
        * 模块文件: ```modules/module1.js```  
            ```js
            module.exports = {
                msg: 'module1',
                foo(){
                    console.log(this.msg);
                }
            }
            ```
        * 引用文件: ```index.js```  
            ```js
            let module1 = require("./modules/module1");
            module1.foo();
            ```
    2. 暴露一个函数
        * 模块文件: ```modules/module2.js```  
            ```js
            module.exports = function(){
                console.log("module2");
            }
            ```
        * 引用文件: ```index.js```  
            ```js
            let module2 = require("./modules/module2");
            module2();
            ```
    3. 直接添加属性到```exports```对象
        * 模块文件: ```modules/module3.js```  
            ```js
            exports.foo = function(){  // module.exports.foo 省略 module 的简写
                console.log("foo() module3");
            }

            /**等价于**/
            /*
            module.exports.foo = function(){
                consojle.log("module3);
            }
            */
            ``` 
        * 引用文件: ```index.js```  
            ```js
            let module3 = require("./modules/module3");
            module3.foo();
            ```
    4. 模块文件为空
        * 模块文件: ```modules/module3.js```  
            ```js
            /* 空 */
            ```
        * 引用文件: ```index.js```  
            ```js
            let module4 = require("./modules/module4");
            console.log(module4);  // {}, module4是一个空对象
            ```

### 实现

* 服务器端实现  
    * Node.js
    * http://nodejs.cn
* 浏览器端实现
    * Browserify
    * http://browserify.org
    * 也称为CommonJS的浏览器端的打包工具
* 区别Node与Browerify



## AMD

### 说明

* Asychromous Module Definition(异步模块定义)
* https://github.com/amdjs/amdjs-api/wiki/AMD
* 专门用于浏览器端, 模块的加载是异步的
* AMD规范的作者亲自实现了符合AMD规范的**requireJS**
* html页面脚本引入时有所不同: 
    ```html
    <script data-main='index.js' src='lib/require.js'></script>
    ```

<!-- ### IIFE(immediately invoked function expression)

* 暴露模块


* 引入模块


* 使用模块

* 加载主模块

* 例子
    * 模块文件
        * ```modules/dataService.js```  
            ```js
            (function (window) {
                let name = "dataService.js";
                function getName(){
                    return name;
                }
                window.dataService = {getName};
            })(window);
            ```
        * ```modules/dataService.js```
            ```js
            (function (window, dataService) {
                let msg = "alert.js";
                function showMsg(){
                    return msg, dataService.getName;
                }
                window.alerter = {showMsg};
            })(window, dataService);
            ```
    * 引入文件
    * 主页面使用模块
        * ```index.js```
            ```html
                <script src="./index.js"> </script>
            ``` -->


### RequireJS

* 暴露模块  
    * 定义没有依赖的模块
        ```js
        // 定义没有依赖的模块
        define(function(){
            let module = {}
            return module;
        })
        ```
    * 定义有依赖的模块
        ```js
        define(['module1', 'module2'], function(m1, m2){
            let module ={};
            return module; 
        })
        ```

* 引入模块
    ```js
    require(['module1', 'module2'], function(m1, m2){
        // 使用 m1, m2
    })
    ```

* 主模块

* html页面加载模块
    ```html
    <script data-main="index.js" src="lib/require.js"></script>
    ```

* 例子  
    * 模块文件
    * 引用文件

### 实现





---

参考资料
---

* [尚硅谷JS模块化](https://www.bilibili.com/video/BV18s411E7Tj?t=50)